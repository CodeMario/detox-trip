<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DetoxTrip</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            border-bottom: 1px solid #ddd;
        }

        .logo {
            color : #144e37;
            font-size : 18px;
            font-weight: bold;
        }

        .logo img {
            width: auto;
            height: 18px;
        }

        .greeting {
            font-size: 18px;
            font-weight: bold;
        }

        .icons {
            display: flex;
            gap: 15px;
        }

        .icon {
            width: 30px;
            height: 30px;
            background-color: #ccc;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-size: 16px;
            cursor: pointer;
        }

        .menu {
            display: flex;
            justify-content: center;
            gap: 50px;
            padding: 10px 20px;
            border-bottom: 1px solid #ddd;
        }

        .menu button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #007BFF;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .menu button:hover {
            background-color: #0056b3;
        }

        .main-content {
            display: flex;
            justify-content: space-around;
            padding: 20px;
        }

        .schedule, .goals {
            width: 45%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fefefe;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .schedule h2, .goals h2 {
            margin-top: 0;
            color: #144e37;
        }

        .goals ul {
            list-style: none;
            padding: 0;
        }

        .goals li {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .goals input[type="checkbox"] {
            margin-right: 10px;
        }

        .no-schedule {
            color: #999;
            font-style: italic;
        }
    </style>
</head>
<body>

<header>
    <div class="logo">
        <img src="/logo.png"> DetoxTrip
    </div>
    <div class="greeting">ì•ˆë…•í•˜ì„¸ìš”, ì‚¬ìš©ìë‹˜</div>
    <div class="icons">
        <div class="icon">ğŸ‘¤</div>
        <div class="icon">ğŸš¨</div>
    </div>
</header>

<div class="menu">
    <button onclick="location.href='page1.html'">ì—¬í–‰ ì¼ì •</button>
    <button onclick="location.href='page2.html'">ì—¬í–‰ì§€ ì¶”ì²œ</button>
    <button onclick="location.href='page3.html'">ì»¤ë®¤ë‹ˆí‹°</button>
    <button onclick="location.href='page4.html'">ì—¬í–‰ ë¦¬ë·°</button>
</div>

<div class="main-content">
    <div class="schedule">
        <h2>ì—¬í–‰ ì¼ì •</h2>
        <div id="schedule-content" class="no-schedule">ê³„íšëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>
    </div>
    <div class="goals">
        <h2>ëª©í‘œ</h2>
        <ul id="goal-list">
            <li class="no-goals">ëª©í‘œê°€ ì—†ìŠµë‹ˆë‹¤.</li>
        </ul>
    </div>
</div>

<script>
    // ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ë° ë Œë”ë§
    async function fetchData() {
        try {
            // ìœ ì € ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const userResponse = await fetch('/users/me');
            const userData = await userResponse.json();

            // ìœ ì € ë°ì´í„°ì˜ result ì†ì„±ì—ì„œ ì •ë³´ ì ‘ê·¼
            const user = userData.result; // result ê°ì²´ ì¶”ì¶œ

            // ê³„ì • ë¹„í™œì„±í™” ì²´í¬
            if (!user.is_active) {
                alert('ê³„ì •ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                window.location.href = "/index.html";
                return;
            }

            // ê´€ë¦¬ì ì—¬ë¶€ ì²´í¬
            if (user.is_admin) {
                window.location.href = "/admin.html";
                return;
            }

            // ìœ ì € ë‹‰ë„¤ì„ ë°˜ì˜
            const greeting = document.querySelector('.greeting');
            greeting.textContent = `ì•ˆë…•í•˜ì„¸ìš”, ${user.nickname}ë‹˜`;

            // ì—¬í–‰ ì¼ì • ë° ëª©í‘œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const itineraryResponse = await fetch('/itineraries');
            const itineraryData = await itineraryResponse.json();

            // ì—¬í–‰ ì¼ì • ë Œë”ë§
            const scheduleContent = document.getElementById('schedule-content');
            const itinerary = itineraryData.result;

            if (itinerary) {
                scheduleContent.classList.remove('no-schedule');
                const startDate = new Date(itinerary.start_date).toISOString().split('T')[0];
                const endDate = new Date(itinerary.end_date).toISOString().split('T')[0];
                scheduleContent.innerHTML = `
                <p><strong>ì¼ì •:</strong> ${startDate} ~ ${endDate}</p>
                `;
            }

            // ëª©í‘œ ë Œë”ë§
            const activities = itinerary.Activities;  // ì„œë²„ì—ì„œ ë°›ì€ activities ë°ì´í„°
            
            // ëª©í‘œ ë Œë”ë§
            const goalList = document.getElementById('goal-list');
            console.log('Activities data:', activities);
            if (activities && activities.length > 0) {
                goalList.innerHTML = activities.map(activity => `
                    <li>
                        <input type="checkbox">
                        <span>${activity.activity_name} (${activity.target_time}ë¶„)</span>
                    </li>
                `).join('');
            } else {
                goalList.innerHTML = '<li class="no-goals">ëª©í‘œê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
            }
        } catch (error) {
            console.error('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', error);
        }
    }
    fetchData();
</script>

</body>
</html>